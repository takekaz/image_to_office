
# Image to Office Converter アプリケーション

## 概要

このアプリケーションは、指定された画像フォルダ内の複数の画像から特定領域を抽出し、それらをMicrosoft ExcelファイルまたはMicrosoft PowerPointファイルに自動的に挿入するためのGUIツールです。
各画像は新しいシート（Excel）または新しいスライド（PowerPoint）に挿入され、設定ファイルに基づいて画像領域と出力先のセル/スライド座標が管理されます。

## 機能

*   **画像フォルダと出力パスの指定**: GUIから画像フォルダ、Excel出力ファイル、PowerPoint出力ファイルを簡単に選択できます。
*   **設定ファイルの自動生成と読み込み**: `config.json` ファイルが存在しない場合や破損している場合に、デフォルト設定で自動的に生成します。
*   **画像領域の編集**:
    *   **領域確認・変更画面 (`region_editor.py`)**:
        *   サンプル画像の最初の1枚のみを実寸大で表示し、画像がウィンドウよりも大きい場合はスクロールバーが表示されます。
        *   既存の画像領域を青い矩形でオーバーレイ表示します。
        *   矩形の移動（ドラッグ）、リサイズ（コーナー/辺のドラッグ）が可能です。
        *   新規領域の追加（空のスペースからのドラッグ）が可能です。
        *   右クリックで領域の削除やExcelセル座標の変更が可能です。
        *   領域番号が表示され、背景色が黒で視認性が向上しています。
        *   移動・リサイズ・新規作成中に操作内容と座標を表示するツールチップが表示されます。
*   **Excelセル座標の編集**:
    *   **出力セル確認・変更画面 (`excel_cell_editor.py`)**:
        *   Excelシートのようなグリッド画面で、セル座標を矩形でオーバーレイ表示します。
        *   列ラベル（A, B, C...）と行ラベル（1, 2, 3...）が常に表示され、スクロールしても追従します。
        *   矩形内どこでもドラッグしてセル座標を移動できます。
        *   初期画面サイズは、ある程度のセル範囲が収まるように動的に調整されます。
*   **Excel出力**: 指定された画像領域をExcelファイルに挿入します。画像ごとに新しいシートが作成されます。
*   **PowerPoint出力**: 指定された画像領域をPowerPointファイルに挿入します。画像ごとに新しいスライドが作成されます。
*   **ファイル上書き確認と連番付加**: ExcelまたはPowerPoint出力時、出力先に同名のファイルが存在する場合、上書きするか、ファイル名に連番を付加して新しいファイルとして保存するかを選択できます。

## インストール

このアプリケーションを実行するには、Pythonといくつかのライブラリが必要です。

1.  **リポジトリのクローン**:
    ```bash
    git clone https://github.com/takekaz/image_to_office.git
    cd image_to_office
    ```

2.  **Python環境の準備**:
    Python 3.8以上を推奨します。仮想環境の利用を強く推奨します。
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # macOS/Linux
    # venv\Scripts\activate   # Windows
    ```

3.  **必要なライブラリのインストール**:
    `requirements.txt` に記載されているライブラリをインストールします。
    ```bash
    pip install -r requirements.txt
    ```
    (必要なライブラリ: `Pillow`, `openpyxl`, `python-pptx`, `tk` (TkinterはPython標準ライブラリですが、システムによっては別途インストールが必要な場合があります。例: Ubuntu/Debianでは `sudo apt-get install python3-tk`))

4.  **サンプル画像の生成 (オプション)**:
    `img` フォルダにサンプル画像がない場合、または新しいサンプル画像を生成したい場合は、以下のスクリプトを実行します。
    ```bash
    python generate_images.py
    ```
    これにより、`img/` フォルダに10個のJPEG画像が生成されます。

## 使い方

1.  **アプリケーションの起動**:
    ```bash
    python main.py
    ```
    GUIアプリケーションが起動します。

2.  **パスの設定**:
    *   「画像フォルダ」: 処理したい画像が保存されているフォルダを指定します。デフォルトでは `img/` フォルダが設定されています。
    *   「Excel出力パス」: 生成されるExcelファイルの保存先とファイル名を指定します。
    *   「PowerPoint出力パス」: 生成されるPowerPointファイルの保存先とファイル名を指定します。

3.  **画像領域とExcel/PowerPoint設定の確認・変更**:
    *   **「領域確認・変更」ボタン**:
        *   クリックすると、新しいウィンドウが開き、`img/` フォルダ内の最初の画像が表示されます。
        *   既存の画像領域が青い矩形で表示されます。
        *   **移動**: 矩形をクリック＆ドラッグで移動します。
        *   **リサイズ**: 矩形のコーナーまたは辺にある赤い（コーナー）または緑色（辺）のハンドルをドラッグしてサイズを変更します。
        *   **新規作成**: 空のスペースで20ピクセル以上ドラッグすると、新しい領域を作成できます。
        *   **削除**: 領域を右クリックし、「領域を削除」を選択します。
        *   **Excelセル座標変更**: 領域を右クリックし、「Excelセル座標を変更」を選択すると、その領域に対応するExcelセル座標を直接入力できます。
        *   ウィンドウを閉じるときに、変更を保存するかどうかを確認するプロンプトが表示されます。
    *   **「出力セル確認・変更」ボタン**:
        *   クリックすると、Excelシートのようなグリッド画面が新しいウィンドウで開きます。
        *   既存のExcelセル座標が水色の矩形で表示されます。
        *   矩形内どこでもクリック＆ドラッグでセル座標を移動できます。
        *   右クリックでその領域のExcelセル座標を直接入力できます。
        *   ウィンドウを閉じるときに、変更を保存するかどうかを確認するプロンプトが表示されます。

4.  **Excel/PowerPointファイルの出力**:
    *   **「Excel出力」ボタン**: 設定に基づいてExcelファイルを生成します。
    *   **「PowerPoint出力」ボタン**: 設定に基づいてPowerPointファイルを生成します。
    *   出力ファイルが存在する場合、上書き確認ダイアログが表示され、「はい」（上書き）、「いいえ」（連番付加）、「キャンセル」を選択できます。

## 設定ファイル (`config.json`)

アプリケーションは、`main.py` と同じディレクトリにある `config.json` を読み込みます。このファイルが存在しない場合や破損している場合は、デフォルト値で自動生成されます。

`config.json` の例:

```json
{
    "image_regions_and_excel_coords": [
        {
            "img_region": [100, 100, 200, 150],
            "excel_pos": "B2"
        },
        {
            "img_region": [50, 50, 150, 120],
            "excel_pos": "D5"
        }
    ],
    "excel_to_pptx_conversion_params": {
        "col_width_pix": 64,
        "row_height_pix": 20,
        "dpi": 96
    }
}
```

*   `image_regions_and_excel_coords`:
    *   `img_region`: 画像から切り抜く領域を `[x1, y1, x2, y2]` の形式で指定します（ピクセル座標）。これはPillowの `crop()` メソッドと同じ形式です。
    *   `excel_pos`: 画像領域を挿入するExcelのセル座標を文字列で指定します（例: "B2"）。
*   `excel_to_pptx_conversion_params`:
    *   Excelのセル座標をPowerPointのスライド上の位置に変換するためのパラメータです。
    *   `col_width_pix`: Excelの1列あたりのピクセル幅の目安。
    *   `row_height_pix`: Excelの1行あたりのピクセル高さの目安。
    *   `dpi`: ドット/インチ。画像やExcel/PowerPointの標準解像度に合わせて調整します。

## 開発環境

*   **Pythonバージョン**: 3.x
*   **依存ライブラリ**:
    *   `Pillow` (PIL Fork): 画像処理
    *   `openpyxl`: Excelファイル操作
    *   `python-pptx`: PowerPointファイル操作
    *   `tk`: Tkinter (Python標準GUIライブラリ)

## 注意事項

*   `tk` (Tkinter) はPythonに標準で含まれていますが、Linux環境などでは別途パッケージ（例: `python3-tk`）のインストールが必要な場合があります。
*   生成されるExcel/PowerPointファイルは、Microsoft Office製品で開くことを想定しています。
*   画像処理には `Pillow` ライブラリを使用しています。対応している画像形式はJPEG, PNG, GIF, BMP, TIFFなどです。
*   PowerPoint出力時、Excelのセル座標からスライド上の位置への変換は、`config.json` の `excel_to_pptx_conversion_params` に依存します。この値は環境やExcel/PowerPointのデフォルト設定によって調整が必要な場合があります。
